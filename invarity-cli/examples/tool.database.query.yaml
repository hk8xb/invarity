# Tool definition for database query operations (v3 schema)
# Uses Claude-style input_schema instead of OpenAI parameters

name: db_query
description: Execute a read-only SQL query against the analytics database.

# Claude-style input schema
input_schema:
  type: object
  additionalProperties: false
  properties:
    query:
      type: string
      description: SQL SELECT query to execute
      maxLength: 10000
    database:
      type: string
      description: Target database name
      enum:
        - analytics
        - reporting
        - logs
    limit:
      type: integer
      description: Maximum rows to return
      minimum: 1
      maximum: 10000
      default: 100
    timeout_seconds:
      type: integer
      description: Query timeout in seconds
      minimum: 1
      maximum: 300
      default: 30
  required:
    - query
    - database

# Invarity-specific metadata for the firewall (v3 schema)
invarity:
  id: database.query
  version: 1.0.0

  # Risk metadata (all required)
  risk:
    base_risk: low
    operation: read
    requires_human_review: false
    tags:
      - database
      - analytics
      - read-only
    notes: "Read-only access to analytics databases"

  # Constraints (all required - no inference)
  constraints:
    requires_justification: false
    required_args:
      - query
      - database
    disallow_wildcards: true
    max_bulk: 10000
    amount_limit: null
    notes: "Max 10k rows per query. Wildcards disallowed to prevent SELECT *."
